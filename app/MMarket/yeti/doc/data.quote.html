<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html><meta http-equiv="Content-Type" content="text/html;charset=utf-8" ><style type="text/css">
.main { background: white; line-height: 130%; font-family: sans-serif }
.type { background: white; font-size: 12pt; }
.sn { font: 13pt monospace }
.vn { font-size: 13pt }
.other { background: #cccccc; display: inline; }
.field { padding: 1.5pt }
.wdoc { padding-top: 0.5em; padding-bottom: 0.4em; }
var { font: 11pt monospace }
.args { padding-left: 1.4em }
.args tr td { vertical-align: text-top }
td.arg { width: 100% }
/*.wdoc { margin-top: 0.6em; margin-bottom: 0.6em; } */
.box { border: 1px solid black;
    /* top/bottom right/left | top right/left bottom | top right bottom left */
    padding: 1px 0.1em 1pt;
    margin: 1px 1pt 0pt;
    display: inline-block; }
.module { color: #000080 }
.group { font: 16pt sans-serif; border-bottom: solid black 1px;
         padding: 0px; margin: 0.5em 0px; text-align: center }
em { color: #000080; font: bold 13pt sans-serif }
.function { background: #ffffff }
.struct { background: #ffffff }
.variant { background: #c7c7ff }
/* background: #bbffbb; */
.ft { padding-left: 0em }
.doc { background: #ffffa8;
    padding: 0.5em 0.5em 0.5em 2em;
    font-size: 12pt; }
.contents { background: #dddddd; padding: 0.5em; font-size: 10pt }
.contents a { text-decoration: none }
.contents a:hover { text-decoration: underline }
.doc p { margin: 0.6em 0px 1px; font-weight: bold }
.doc pre { background: #ffffc8;
    border: 1px dashed black;
    margin: 0.3em 1.5em 0.3em 0px;
    padding: 0.3em; overflow: auto }
</style><title>data.quote</title>
<body>
<div class="main">
<h2><span class=module>module</span> data.quote</h2>
<div class="doc">Quote data.</div><p><div class="type"><em>typedef</em> t = <em>{</em><div class="box struct" style="display: block; margin: 2pt"><div id="close" class=field><span class=sn>close</span><em> is </em>number, </div>
<div id="date" class=field><span class=sn>date</span><em> is </em>string, </div>
<div id="err" class=field><span class=sn>err</span><em> is </em>boolean, </div>
<div id="max" class=field><span class=sn>max</span><em> is </em>number, </div>
<div id="min" class=field><span class=sn>min</span><em> is </em>number, </div>
<div id="open" class=field><span class=sn>open</span><em> is </em>number, </div>
<div id="vol" class=field><span class=sn>vol</span><em> is </em>number</div>
</div><em>}</em></div>
<h3>Module signature</h3>
<div class="type"><em>{</em><div class="box struct" style="display: block; margin: 2pt"><div class=contents><a href="#correct">correct</a> <a href="#correct1">correct1</a> <a href="#correct2">correct2</a> <a href="#correct3">correct3</a> <a href="#correctDates">correctDates</a> <a href="#fromJs">fromJs</a> <a href="#fromStr">fromStr</a> <a href="#manuals">manuals</a> <a href="#merge">merge</a> <a href="#mk">mk</a> <a href="#toJs">toJs</a> <a href="#toStr">toStr</a> <a href="#unify">unify</a></div><div id="correct" class="field wdoc"><span class=sn>correct</span> <var>qs</var><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; <em>{</em><span class=sn>`errors</span><em> is </em>list<tt>&lt;</tt>string<tt>&gt;</tt>, <span class=sn>`qs</span><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt><em>}</em>, <div class="doc">Corrects <var>"qs"</var> and returns a list with corrected quotes.<table class="args"><tr><td><var>qs</var><td>-<td class=arg>Historic quotes.</table><p>Notes</p>Return is:
<pre>
 {
   errors : A list with messages coming from correct1, correct2 and
            correct3. If there was no error, it is an empty list.
   qs : Quotes corrected if neccessary.
 }
</pre></div></div>
<div id="correct1" class="field wdoc"><span class=sn>correct1</span> <var>q</var><em> is </em>t &rarr; <em>{</em><span class=sn>`error</span><em> is </em>string, <span class=sn>`q</span><em> is </em>t<em>}</em>, <div class="doc">Checks maximum and minimum and returns a new quote corrected.<p></p>If <var>q</var>.err = true, quote will not be corrected.<p></p>If quote was corrected, its 'err' field is set to 'true'.<table class="args"><tr><td><var>q</var><td>-<td class=arg>Quote to correct</table><p>Notes</p>Return is
<pre>
 {
   error: A message (e.g. Max &gt; Min) if there was some error or
          an empty string otherwise.
   q : Quote corrected if neccessary.
 }
</pre></div></div>
<div id="correct2" class="field wdoc"><span class=sn>correct2</span> <var>last</var> <var>previous</var><em> is </em>t &rarr; t &rarr; <em>{</em><span class=sn>`error</span><em> is </em>string, <span class=sn>`q</span><em> is </em>t<em>}</em>, <div class="doc">Checks maximum and minimum and returns a new quote corrected.<p></p>If <var>last</var>.err = true, quote will not be corrected.<p></p>If quote was corrected, its 'err' field is set to 'true'.<table class="args"><tr><td><var>last</var><td>-<td class=arg>Quote to correct<tr><td><var>previous</var><td>-<td class=arg>Quote previous to <var>"last"</var></table><p>Notes</p>Return is
<pre>
 {
   error : A message (e.g. Close &lt; Min) if there was some error or
           an empty string otherwise.
   q : Quote corrected if neccessary.
 }
</pre></div></div>
<div id="correct3" class="field wdoc"><span class=sn>correct3</span> <var>last</var> <var>previous</var><em> is </em>t &rarr; t &rarr; <em>{</em><span class=sn>`error</span><em> is </em>string, <span class=sn>`q</span><em> is </em>t<em>}</em>, <div class="doc">Checks increment (+-20%) and returns a new quote corrected.<p></p>If <var>last</var>.err = true, quote will not be corrected.<p></p>If quote was corrected, its 'err' field is set to 'true'.<table class="args"><tr><td><var>last</var><td>-<td class=arg>Quote to correct<tr><td><var>previous</var><td>-<td class=arg>Quote previous to <var>"last"</var></table><p>Notes</p>Return is
<pre>
 {
   error : A message (e.g. Min + 20%) if there was some error or
           an empty string otherwise.
   q : Quote corrected if neccessary (only 'err' field).
 }
</pre></div></div>
<div id="correctDates" class="field wdoc"><span class=sn>correctDates</span> <var>mqs</var> <var>qs</var><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; <em>{</em><span class=sn>`errors</span><em> is </em>list<tt>&lt;</tt>string<tt>&gt;</tt>, <span class=sn>`qs</span><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt><em>}</em>, <div class="doc">Corrects <var>"qs"</var> and returns a list with corrected quotes.<table class="args"><tr><td><var>mqs</var><td>-<td class=arg>Historic quotes of company model<tr><td><var>qs</var><td>-<td class=arg>Historic quotes of company.</table><p>Notes</p>Return is:
<pre>
 {
   errors : Errors by extra o missing quotes. If there was no errors,
            it is an empty list.
   qs : Quotes corrected if neccessary.
 }
</pre></div></div>
<div id="fromJs" class="field wdoc"><span class=sn>fromJs</span> <var>js</var><em> is </em>json.t &rarr; t, <div class="doc">Restores from JSON.<table class="args"><tr><td><var>js</var><td>-<td class=arg>JSON value.</table></div></div>
<div id="fromStr" class="field wdoc"><span class=sn>fromStr</span> <var>s</var><em> is </em>string &rarr; option<tt>&lt;</tt>t<tt>&gt;</tt>, <div class="doc">Returns a Quote from its string representation.<table class="args"><tr><td><var>s</var><td>-<td class=arg>Quote representation.</table></div></div>
<div id="manuals" class="field wdoc"><span class=sn>manuals</span> <var>qs</var><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; number, <div class="doc">Returns the number of manual corrections in <var>qs</var>.<table class="args"><tr><td><var>qs</var><td>-<td class=arg>Quotes.</table></div></div>
<div id="merge" class="field wdoc"><span class=sn>merge</span> <var>model</var> <var>newQs</var> <var>oldQs</var><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; list<tt>&lt;</tt>t<tt>&gt;</tt> &rarr; <em>{</em><span class=sn>errors</span><em> is </em>list<tt>&lt;</tt>string<tt>&gt;</tt>, <span class=sn>qs</span><em> is </em>list<tt>&lt;</tt>t<tt>&gt;</tt><em>}</em>, <div class="doc">Merges new quotes with others already existent.<table class="args"><tr><td><var>model</var><td>-<td class=arg>Model quotes. When quotes are of company model, it is an
empty array.<tr><td><var>newQs</var><td>-<td class=arg>Last quotes read from the Internet. It can not be empty.<tr><td><var>oldQs</var><td>-<td class=arg>Existent quotes in file system. It can not be empty.</table><p>Description</p>It returns:
<pre>
 errors - Errors returned by 'correct' and 'correctDates' with format
          "date: error". If there is no error, the array is empty.
 qs - Array made with the following process:
      1. Every quote on top with 'open = -1' is removed from "oldQs"
         in the dates range of "newQs"
      2. If there are new and old quotes for the same date, that of
         'old' is selected.
      3. The return array is corrected in the range of 'new' dates
         and added or removed quotes maching model quotes.
</pre></div></div>
<div id="mk" class="field wdoc"><span class=sn>mk</span> <var>date</var> <var>open</var> <var>close</var> <var>max</var> <var>min</var> <var>vol</var> <var>err</var><em> is </em><div class="box function"><div class=field>string &rarr; </div>
<div class=field>number &rarr; </div>
<div class=field>number &rarr; </div>
<div class=field>number &rarr; </div>
<div class=field>number &rarr; </div>
<div class=field>number &rarr; </div>
<div class=field>boolean &rarr; </div>
<div class=field>t</div>
</div>, <div class="doc">Create a new quote.<table class="args"><tr><td><var>date</var><td>-<td class=arg>Date of quote in format <var>"YYYYMMDD"</var>.<tr><td><var>open</var><td>-<td class=arg>Open value.<tr><td><var>close</var><td>-<td class=arg>Close value.<tr><td><var>max</var><td>-<td class=arg>Maximum value.<tr><td><var>min</var><td>-<td class=arg>Minimum value.<tr><td><var>vol</var><td>-<td class=arg>Valume value.<tr><td><var>err</var><td>-<td class=arg>'true' if quote was modified manually.</table></div></div>
<div id="toJs" class="field wdoc"><span class=sn>toJs</span> <var>q</var><em> is </em>t &rarr; json.t, <div class="doc">Serializes to JSON.<table class="args"><tr><td><var>q</var><td>-<td class=arg>Quote.</table></div></div>
<div id="toStr" class="field wdoc"><span class=sn>toStr</span> <var>q</var><em> is </em>t &rarr; string, <div class="doc">Returns a string representation of <var>"q"</var>.<table class="args"><tr><td><var>q</var><td>-<td class=arg>Quote.</table></div></div>
<div id="unify" class="field wdoc"><span class=sn>unify</span> <var>aQs</var> <var>ix</var><em> is </em>array<tt>&lt;</tt>list<tt>&lt;</tt>t<tt>&gt;</tt><tt>&gt;</tt> &rarr; number &rarr; list<tt>&lt;</tt>t<tt>&gt;</tt><div class="doc">Unifies serveral list of quotes in one.<table class="args"><tr><td><var>aQs</var><td>-<td class=arg>Arrays to unify. Every quote has a .err value equals to false.<tr><td><var>ix</var><td>-<td class=arg>The list of <var>"aQs"</var> selected for tiebreaks.</table></div></div>
</div><em>}</em></div>
</div>
</body></html>
