crystal_doc_search_index_callback({"repository_name":"github.com/dedeme/dmWeb","body":"","program":{"html_id":"github.com/dedeme/dmWeb/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[{"html_id":"github.com/dedeme/dmWeb/DedemeLib","kind":"module","full_name":"DedemeLib","name":"DedemeLib"}],"locations":[],"repository_name":"github.com/dedeme/dmWeb","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[{"html_id":"github.com/dedeme/dmWeb/DedemeLib","kind":"module","full_name":"DedemeLib","name":"DedemeLib"}],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/DedemeLib","kind":"module","full_name":"DedemeLib","name":"DedemeLib"}],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/dedeme/dmWeb/Dummy2","path":"Dummy2.html","kind":"module","full_name":"Dummy2","name":"Dummy2","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/cgi.cr","line_number":10,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr"},{"filename":"dummy2/cts.cr","line_number":5,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr"},{"filename":"dummy2/dummy2.cr","line_number":6,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/dummy2.cr"},{"filename":"dummy2/version.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/version.cr"},{"filename":"dummy2/data/conf.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/conf.cr"},{"filename":"dummy2/data/iout.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr"},{"filename":"dummy2/pages/main.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/main.cr"},{"filename":"dummy2/pages/core/backups.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/backups.cr"},{"filename":"dummy2/pages/core/settings.cr","line_number":4,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/settings.cr"},{"filename":"dummy2.cr","line_number":11,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"2018.10.6\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"Dummy client-server application","summary":"<p>Dummy client-server application</p>","class_methods":[{"id":"process(rq:JSON::Any):Tuple(Bool,String)-class-method","html_id":"process(rq:JSON::Any):Tuple(Bool,String)-class-method","name":"process","doc":null,"summary":null,"abstract":false,"args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"args_string":"(rq : JSON::Any) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/dummy2.cr#L7","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/dummy2.cr#L7","def":{"name":"process","args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"if pg = rq[\"page\"]\n  case pg.as_s\n  when \"main\"\n    Main.process(rq)\n  when \"settings\"\n    Settings.process(rq)\n  when \"backups\"\n    Backups.process(rq)\n  else\n    Cgi.fail(\"Page '#{pg.as_s}' is unknown\")\n  end\nelse\n  Cgi.fail(\"Field 'page' is missing\")\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Backups","path":"Dummy2/Backups.html","kind":"module","full_name":"Dummy2::Backups","name":"Backups","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/pages/core/backups.cr","line_number":5,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/backups.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Backups","kind":"module","full_name":"Dummy2::Backups","name":"Backups"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","html_id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","name":"process","doc":null,"summary":null,"abstract":false,"args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"args_string":"(rq : JSON::Any) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/backups.cr#L8","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/backups.cr#L8","def":{"name":"process","args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"if r = rq[\"rq\"]\n  case r.as_s\n  when \"lists\"\n    backups, trash = Iout.backups_trash_lists.values\n    Cgi.ok do |jsb|\n      jsb.field(\"backups\") do\n        jsb.array do\n          backups.each do |b|\n            jsb.string(b)\n          end\n        end\n      end\n      jsb.field(\"trash\") do\n        jsb.array do\n          trash.each do |b|\n            jsb.string(b)\n          end\n        end\n      end\n    end\n  when \"backup\"\n    Cgi.ok do |jsb|\n      jsb.field(\"name\") do\n        jsb.string(Iout.backup)\n      end\n    end\n  when \"restoreStart\"\n    Iout.restore_start\n    Cgi.ok\n  when \"restoreAppend\"\n    if data = rq[\"data\"]\n      Iout.restore_append((      B64.decode_bytes(data.as_s)))\n      Cgi.ok\n    else\n      Cgi.fail(\"Backups-restoreStart: Field 'data' is missing\")\n    end\n  when \"restoreEnd\"\n    Cgi.ok do |jsb|\n      jsb.field(\"fail\") do\n        jsb.string(Iout.restore_end)\n      end\n    end\n  when \"autorestore\"\n    if file = rq[\"file\"]\n      Iout.autorestore(file.as_s)\n      Cgi.ok\n    else\n      Cgi.fail(\"Backups-autorestore: Field 'file' is missing\")\n    end\n  when \"restoreTrash\"\n    if file = rq[\"file\"]\n      Iout.restoreTrash(file.as_s)\n      Cgi.ok\n    else\n      Cgi.fail(\"Backups-restoreTrash: Field 'file' is missing\")\n    end\n  when \"clearTrash\"\n    Iout.clearTrash\n    Cgi.ok\n  else\n    Cgi.fail(\"Backups-rq: value '#{r.as_s}' is unknown\")\n  end\nelse\n  Cgi.fail(\"Backups: Field 'rq' is missing\")\nend"}}],"macros":[],"types":[]},{"html_id":"github.com/dedeme/dmWeb/Dummy2/Cgi","path":"Dummy2/Cgi.html","kind":"class","full_name":"Dummy2::Cgi","name":"Cgi","abstract":false,"superclass":{"html_id":"github.com/dedeme/dmWeb/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/dedeme/dmWeb/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/dedeme/dmWeb/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"dummy2/cgi.cr","line_number":11,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"Klen","name":"Klen","value":"300","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[{"id":"fail(msg:String):Tuple(Bool,String)-class-method","html_id":"fail(msg:String):Tuple(Bool,String)-class-method","name":"fail","doc":"Returns a 'fail' response.","summary":"<p>Returns a 'fail' response.</p>","abstract":false,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"String"}],"args_string":"(msg : String) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L121","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L121","def":{"name":"fail","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"{true, msg}"}},{"id":"ok(&block):Tuple(Bool,String)-class-method","html_id":"ok(&amp;block):Tuple(Bool,String)-class-method","name":"ok","doc":"Returns a 'ok' response. This response contains an object and you should\nsupply its fields.\n```\nDmserver.ok do |jsb|\n  jsb.field \"name\" do jsb.string \"Louis\" end\n  jsb.field \"age\" do jsb.number 23 end\nend\n```","summary":"<p>Returns a 'ok' response.</p>","abstract":false,"args":[],"args_string":"(&block) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L133","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L133","def":{"name":"ok","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"{false, JSON.build do |jsb|\n  jsb.object do\n    yield jsb\n  end\nend}"}},{"id":"ok:Tuple(Bool,String)-class-method","html_id":"ok:Tuple(Bool,String)-class-method","name":"ok","doc":"Returns an empty 'ok' response ({false, \"{}\"})","summary":"<p>Returns an empty 'ok' response ({false, \"{}\"})</p>","abstract":false,"args":[],"args_string":" : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L138","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L138","def":{"name":"ok","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"{false, \"{}\"}"}}],"constructors":[{"id":"new(app_name:String,port:Int32,path:String)-class-method","html_id":"new(app_name:String,port:Int32,path:String)-class-method","name":"new","doc":"'app_name' is used as key in the first communication.\n\n'path' is the directory where pages are. e.g. \"/dm/www2/Dummy2\"","summary":"<p>'app_name' is used as key in the first communication.</p>","abstract":false,"args":[{"name":"app_name","doc":null,"default_value":"","external_name":"app_name","restriction":"String"},{"name":"port","doc":null,"default_value":"","external_name":"port","restriction":"Int32"},{"name":"path","doc":null,"default_value":"","external_name":"path","restriction":"String"}],"args_string":"(app_name : String, port : Int32, path : String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L17","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L17","def":{"name":"new","args":[{"name":"app_name","doc":null,"default_value":"","external_name":"app_name","restriction":"String"},{"name":"port","doc":null,"default_value":"","external_name":"port","restriction":"Int32"},{"name":"path","doc":null,"default_value":"","external_name":"path","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(app_name, port, path)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"listen(action:JSON::Any->Tuple(Bool,String))-instance-method","html_id":"listen(action:JSON::Any-&gt;Tuple(Bool,String))-instance-method","name":"listen","doc":"Creates server and block the program waiting requests.\n\nNormal request are send in 'action'\n\nConnection and authentication request are processed automatically","summary":"<p>Creates server and block the program waiting requests.</p>","abstract":false,"args":[{"name":"action","doc":null,"default_value":"","external_name":"action","restriction":"(JSON::Any -> Tuple(Bool, String))"}],"args_string":"(action : JSON::Any -> Tuple(Bool, String))","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L33","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cgi.cr#L33","def":{"name":"listen","args":[{"name":"action","doc":null,"default_value":"","external_name":"action","restriction":"(JSON::Any -> Tuple(Bool, String))"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"server = HTTP::Server.new([HTTP::ErrorHandler.new, HTTP::LogHandler.new, HTTP::StaticFileHandler.new(@path, true, false)]) do |context|\n  context.response.content_type = \"text/plain\"\n  io = context.request.body\n  if io.nil?\n    context.response.print(\"Request body is missing\")\n    next\n  end\n  rq = io.gets_to_end\n  if !(rq.starts_with?(\"#{@app_name}:\"))\n    context.response.print(\"Request does not start with application name\")\n    next\n  end\n  ix = rq.index(':')\n  if ix.nil?\n    context.response.print(\"Request does not start with application name\")\n    next\n  end\n  rq = rq[(ix + 1)...rq.size]\n  ix = rq.index(':')\n  rp = \"\"\n  key = @key\n  if ix.nil?\n    key = rq\n    if key != @session_id\n      rp = JSON.build do |jsb|\n        jsb.object do\n          jsb.field(\"key\", \"\")\n          jsb.field(\"connectionId\", \"\")\n        end\n      end\n    else\n      rp = JSON.build do |jsb|\n        jsb.object do\n          jsb.field(\"key\", @key)\n          jsb.field(\"connectionId\", @connection_id)\n        end\n      end\n    end\n  else\n    if ix == 0\n      if @first_time\n        @first_time = false\n        rp = JSON.build do |jsb|\n          jsb.object do\n            jsb.field(\"key\", @key)\n            jsb.field(\"sessionId\", @session_id)\n          end\n        end\n        key = B64.key(@app_name, Klen)\n      else\n        context.response.print(\"Connection already open\")\n        next\n      end\n    else\n      ss_id = rq[0...ix]\n      msg = B64.decryp(@key, rq[(ix + 1)...rq.size])\n      if ss_id == @session_id\n        fail, rp = action.call(JSON.parse(msg))\n        if fail\n          context.response.print(rp)\n          next\n        end\n      else\n        context.response.print(\"Bad session id\")\n        next\n      end\n    end\n  end\n  context.response.print(B64.cryp(key, rp))\nend\nserver.bind_tcp(\"localhost\", @port)\nputs(\"Listening on #{@port}\")\nserver.listen\n"}}],"macros":[],"types":[]},{"html_id":"github.com/dedeme/dmWeb/Dummy2/Cts","path":"Dummy2/Cts.html","kind":"module","full_name":"Dummy2::Cts","name":"Cts","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/cts.cr","line_number":6,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"APP_NAME","name":"APP_NAME","value":"\"Dummy2\"","doc":"Its value must be the same in the client side","summary":"<p>Its value must be the same in the client side</p>"},{"id":"BROWSER_PATH","name":"BROWSER_PATH","value":"\"http://localhost:#{PORT}/index.html\"","doc":"Browser point of entry","summary":"<p>Browser point of entry</p>"},{"id":"DATA_VERSION","name":"DATA_VERSION","value":"\"Dummy2: Data version 201810\"","doc":"Data version","summary":"<p>Data version</p>"},{"id":"PORT","name":"PORT","value":"18106","doc":"PORT","summary":"<p>PORT</p>"},{"id":"WEB_DIRECTORY","name":"WEB_DIRECTORY","value":"\"/dm/www2/#{APP_NAME}\"","doc":"Absolute path of web root directory","summary":"<p>Absolute path of web root directory</p>"},{"id":"WEB_TMP","name":"WEB_TMP","value":"\"#{WEB_DIRECTORY}/tmp\"","doc":"Web temporary directory","summary":"<p>Web temporary directory</p>"}],"included_modules":[],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Cts","kind":"module","full_name":"Dummy2::Cts","name":"Cts"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"backups_dir-instance-method","html_id":"backups_dir-instance-method","name":"backups_dir","doc":"Automatica backups","summary":"<p>Automatica backups</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L33","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L33","def":{"name":"backups_dir","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"\"#{Sys.home}/backups\""}},{"id":"data_dir-instance-method","html_id":"data_dir-instance-method","name":"data_dir","doc":"Data which will be saved in backups","summary":"<p>Data which will be saved in backups</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L28","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L28","def":{"name":"data_dir","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"\"#{Sys.home}/data\""}},{"id":"tmp_dir-instance-method","html_id":"tmp_dir-instance-method","name":"tmp_dir","doc":"Temporary directory connected with www","summary":"<p>Temporary directory connected with www</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L43","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L43","def":{"name":"tmp_dir","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"\"#{Sys.home}/tmp\""}},{"id":"trash_dir-instance-method","html_id":"trash_dir-instance-method","name":"trash_dir","doc":"Decarded backups","summary":"<p>Decarded backups</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L38","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/cts.cr#L38","def":{"name":"trash_dir","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"\"#{Sys.home}/trash\""}}],"macros":[],"types":[]},{"html_id":"github.com/dedeme/dmWeb/Dummy2/Iout","path":"Dummy2/Iout.html","kind":"module","full_name":"Dummy2::Iout","name":"Iout","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/data/iout.cr","line_number":5,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Iout","kind":"module","full_name":"Dummy2::Iout","name":"Iout"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"automatic_backup-instance-method","html_id":"automatic_backup-instance-method","name":"automatic_backup","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L108","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L108","def":{"name":"automatic_backup","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"t = Time.now.to_s(\"%Y%m%d\")\nExt.zip(Cts.data_dir, \"#{Cts.backups_dir}/#{t}.zip\")\nd1 = (Time.now - 7.days).to_s(\"%Y%m%d\")\nd2 = (Time.now - 1.year).to_s(\"%Y%m%d\")\nprevious = \"      \"\n(Io.children(Cts.backups_dir)).sort.reverse.each do |fname|\n  name = fname[0..-5]\n  if name < d2\n    if name[0..3] == previous[0..3]\n      Io.del(\"#{Cts.backups_dir}/#{fname}\")\n    else\n      previous = name\n    end\n  else\n    if name < d1\n      if name[0..5] == previous[0..5]\n        Io.del(\"#{Cts.backups_dir}/#{fname}\")\n      else\n        previous = name\n      end\n    end\n  end\nend\n"}},{"id":"autorestore(file:String)-instance-method","html_id":"autorestore(file:String)-instance-method","name":"autorestore","doc":null,"summary":null,"abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"args_string":"(file : String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L98","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L98","def":{"name":"autorestore","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Ext.unzip(\"#{Cts.backups_dir}/#{file}\", Cts.tmp_dir)\nt = Time.now.to_s(\"%Y%m%d-%H%M%S%L\")\nExt.zip(Cts.data_dir, \"#{Cts.trash_dir}/#{t}.zip\")\nIo.del(Cts.data_dir)\nIo.rename(\"#{Cts.tmp_dir}/data\", Cts.data_dir)\n"}},{"id":"backup:String-instance-method","html_id":"backup:String-instance-method","name":"backup","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L50","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L50","def":{"name":"backup","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"name = \"#{Cts::APP_NAME}Backup#{Time.now.to_s(\"%Y%m%d\")}.zip\"\nIo.del(Cts::WEB_TMP)\nIo.mkdir(Cts::WEB_TMP)\nExt.zip(Cts.data_dir, \"#{Cts.tmp_dir}/#{name}\")\nname\n"}},{"id":"backups_trash_lists:NamedTuple()-instance-method","html_id":"backups_trash_lists:NamedTuple()-instance-method","name":"backups_trash_lists","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : NamedTuple()","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L148","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L148","def":{"name":"backups_trash_lists","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"NamedTuple(backups: Array(String), trash: Array(String))","visibility":"Public","body":"{backups: Io.children(Cts.backups_dir), trash: Io.children(Cts.trash_dir)}"}},{"id":"clearTrash-instance-method","html_id":"clearTrash-instance-method","name":"clearTrash","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L143","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L143","def":{"name":"clearTrash","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Io.del(Cts.trash_dir)\nIo.mkdir(Cts.trash_dir)\n"}},{"id":"init-instance-method","html_id":"init-instance-method","name":"init","doc":"Initialize data base in 'home' and in 'web'","summary":"<p>Initialize data base in 'home' and in 'web'</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L9","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L9","def":{"name":"init","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if !(Io.exists?(Cts::WEB_DIRECTORY))\n  raise(IO::Error.new(\"'#{Cts::WEB_DIRECTORY}' not found\"))\nend\nIo.mkdir(Cts::WEB_TMP)\nif !(Io.exists?(Cts.data_dir))\n  Io.mkdir(Cts.data_dir)\n  Io.mkdir(Cts.backups_dir)\n  Io.mkdir(Cts.trash_dir)\n  Io.symlink(Cts::WEB_TMP, Cts.tmp_dir)\n  Io.write(\"#{Cts.data_dir}/version.txt\", Cts::DATA_VERSION)\n  write_conf(Conf.new(\"es\", \"settings\"))\nend\n"}},{"id":"read_conf:String-instance-method","html_id":"read_conf:String-instance-method","name":"read_conf","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L30","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L30","def":{"name":"read_conf","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"Io.read(\"#{Cts.data_dir}/conf.db\")"}},{"id":"restore_append(bs:Bytes)-instance-method","html_id":"restore_append(bs:Bytes)-instance-method","name":"restore_append","doc":null,"summary":null,"abstract":false,"args":[{"name":"bs","doc":null,"default_value":"","external_name":"bs","restriction":"Bytes"}],"args_string":"(bs : Bytes)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L63","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L63","def":{"name":"restore_append","args":[{"name":"bs","doc":null,"default_value":"","external_name":"bs","restriction":"Bytes"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"f = Io.aopen(\"#{Cts.tmp_dir}/backup.zip\")\nIo.write(f, bs)\nf.close\n"}},{"id":"restore_end:String-instance-method","html_id":"restore_end:String-instance-method","name":"restore_end","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L69","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L69","def":{"name":"restore_end","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"fpath = \"#{Cts.tmp_dir}/backup.zip\"\nif !(Io.exists?(fpath))\n  return \"'#{fpath}' not found\"\nend\nbegin\n  Ext.unzip(fpath, Cts.tmp_dir)\nrescue ex\n  puts(ex.message)\n  return \"restore:unzip\"\nend\nfversion = \"#{Cts.tmp_dir}/data/version.txt\"\nif !(Io.exists?(fversion))\n  return \"restore:valid\"\nend\nif Cts::DATA_VERSION != (Io.read(fversion))\n  return \"restore:version\"\nend\nt = Time.now.to_s(\"%Y%m%d-%H%M%S%L\")\nExt.zip(Cts.data_dir, \"#{Cts.trash_dir}/#{t}.zip\")\nIo.del(Cts.data_dir)\nIo.rename(\"#{Cts.tmp_dir}/data\", Cts.data_dir)\n\"\"\n"}},{"id":"restore_start-instance-method","html_id":"restore_start-instance-method","name":"restore_start","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L58","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L58","def":{"name":"restore_start","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Io.del(Cts::WEB_TMP)\nIo.mkdir(Cts::WEB_TMP)\n"}},{"id":"restoreTrash(file:String)-instance-method","html_id":"restoreTrash(file:String)-instance-method","name":"restoreTrash","doc":null,"summary":null,"abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"args_string":"(file : String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L133","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L133","def":{"name":"restoreTrash","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Ext.unzip(\"#{Cts.trash_dir}/#{file}\", Cts.tmp_dir)\nt = Time.now.to_s(\"%Y%m%d-%H%M%S%L\")\nExt.zip(Cts.data_dir, \"#{Cts.trash_dir}/#{t}.zip\")\nIo.del(Cts.data_dir)\nIo.rename(\"#{Cts.tmp_dir}/data\", Cts.data_dir)\n"}},{"id":"set_lang(lang:String)-instance-method","html_id":"set_lang(lang:String)-instance-method","name":"set_lang","doc":null,"summary":null,"abstract":false,"args":[{"name":"lang","doc":null,"default_value":"","external_name":"lang","restriction":"String"}],"args_string":"(lang : String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L38","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L38","def":{"name":"set_lang","args":[{"name":"lang","doc":null,"default_value":"","external_name":"lang","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"cf = read_conf2\ncf.lang = lang\nwrite_conf(cf)\n"}},{"id":"set_menu(option:String)-instance-method","html_id":"set_menu(option:String)-instance-method","name":"set_menu","doc":null,"summary":null,"abstract":false,"args":[{"name":"option","doc":null,"default_value":"","external_name":"option","restriction":"String"}],"args_string":"(option : String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L44","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/data/iout.cr#L44","def":{"name":"set_menu","args":[{"name":"option","doc":null,"default_value":"","external_name":"option","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"cf = read_conf2\ncf.menu = option\nwrite_conf(cf)\n"}}],"macros":[],"types":[]},{"html_id":"github.com/dedeme/dmWeb/Dummy2/Main","path":"Dummy2/Main.html","kind":"module","full_name":"Dummy2::Main","name":"Main","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/pages/main.cr","line_number":5,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/main.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Main","kind":"module","full_name":"Dummy2::Main","name":"Main"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","html_id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","name":"process","doc":null,"summary":null,"abstract":false,"args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"args_string":"(rq : JSON::Any) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/main.cr#L8","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/main.cr#L8","def":{"name":"process","args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"if r = rq[\"rq\"]\n  case r.as_s\n  when \"init\"\n    Cgi.ok do |jsb|\n      jsb.field(\"conf\") do\n        jsb.raw(Iout.read_conf)\n      end\n    end\n  when \"logout\"\n    spawn do\n      Iout.automatic_backup\n      sleep(1)\n      exit(0)\n    end\n    Cgi.ok\n  when \"setMenu\"\n    if option = rq[\"option\"]\n      Iout.set_menu(option.as_s)\n      Cgi.ok\n    else\n      Cgi.fail(\"Main-setMenu: Field 'option' is missing\")\n    end\n  else\n    Cgi.fail(\"Main-rq: value '#{r.as_s}' is unknown\")\n  end\nelse\n  Cgi.fail(\"Main: Field 'rq' is missing\")\nend"}}],"macros":[],"types":[]},{"html_id":"github.com/dedeme/dmWeb/Dummy2/Settings","path":"Dummy2/Settings.html","kind":"module","full_name":"Dummy2::Settings","name":"Settings","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"dummy2/pages/core/settings.cr","line_number":5,"url":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/settings.cr"}],"repository_name":"github.com/dedeme/dmWeb","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/dedeme/dmWeb/Dummy2/Settings","kind":"module","full_name":"Dummy2::Settings","name":"Settings"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/dedeme/dmWeb/Dummy2","kind":"module","full_name":"Dummy2","name":"Dummy2"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","html_id":"process(rq:JSON::Any):Tuple(Bool,String)-instance-method","name":"process","doc":null,"summary":null,"abstract":false,"args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"args_string":"(rq : JSON::Any) : Tuple(Bool, String)","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/settings.cr#L8","source_link":"https://github.com/dedeme/dmWeb/blob/d461f13491d68453385c8bfeccb6b852294b169d/src/dummy2/pages/core/settings.cr#L8","def":{"name":"process","args":[{"name":"rq","doc":null,"default_value":"","external_name":"rq","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Tuple(Bool, String)","visibility":"Public","body":"if r = rq[\"rq\"]\n  case r.as_s\n  when \"setLang\"\n    if lang = rq[\"lang\"]\n      Iout.set_lang(lang.as_s)\n      Cgi.ok\n    else\n      Cgi.fail(\"Settings-rq-setLang: Field 'lang' is missing\")\n    end\n  else\n    Cgi.fail(\"Settings-rq: value '#{r.as_s}' is unknown\")\n  end\nelse\n  Cgi.fail(\"Settings: Field 'rq' is missing\")\nend"}}],"macros":[],"types":[]}]}]}})